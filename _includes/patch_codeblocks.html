---

# Preprocesses HTML generated from MD to add line spans to code blocks
# This allows for pure CSS line numbering

# TODO: Make sure this doesn't interfere with surrounding things, say HTML 'figure' tags for example

---
{% assign lines = include.html_input | split: '
' %}{% assign incode = 0 %}{% for line in lines %}{% if line contains '<pre class="highlight"><code>' %}{% assign incode = 1 %}{% assign latterpart = line | split: '<pre class="highlight"><code>' | last %}<pre class="highlight"><code>{% include _codepatch_lineparser.html line=latterpart %}{% elsif incode == 1 and line contains '</code></pre>' %}{% assign incode = 0 %}{% assign formerpart = line | split: '</code></pre>' | first %}{% if formerpart != '' %}{% include _codepatch_lineparser.html line=formerpart %}{% endif %}</code></pre>
{% elsif incode == 1 %}{% include _codepatch_lineparser.html line=line %}{% else %}{{ line }}
{% endif %}{% endfor %}